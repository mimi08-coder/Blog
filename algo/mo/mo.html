<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" type="image/png" href="../../style/ava.png" />
  <link rel="canonical" href="https://mimicoder.site/algo/mo/mo.html" />
  <meta charset="UTF-8" />
  <title>Mo Algorithm | Tien Minh's Coding Journal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Mo's algorithm efficiently answers offline range queries on an array by reordering them to minimize redundant computations." />
  <meta name="robots" content="index, follow" />
  <meta name="author" content="Tien Minh" />
  <!-- <script src="https://cdn.tailwindcss.com"></script>   -->
  <link href="../../style/output.css" rel="stylesheet"></head>
   <link href="../../prism/prism.css" rel="stylesheet" />

</head>

<body class="bg-gray-100 text-gray-800 font-sans">
  <!-- Navbar -->
<nav class="bg-white shadow-md sticky top-0 z-50">
  <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
    <!-- Logo + title -->
    <div class="flex items-center space-x-3">
      <img src="../../style/ava.png" alt="Logo" class="h-7 w-7 object-contain" />
      <h1 class="text-xl font-bold text-blue-700">Tien Minh's Coding Journal</h1>
    </div>

    <!-- Desktop nav links -->
    <div class="hidden md:flex space-x-6 text-sm">
      <a href="../../index.html#home" class="hover:text-blue-700">Home</a>
      <a href="../../index.html#algorithms" class="hover:text-blue-700">Algorithms</a>
      <a href="../../index.html#arduino" class="hover:text-blue-700">Arduino</a>
      <a href="../../index.html#about" class="hover:text-blue-700">About</a>
      <a href="../../index.html#contact" class="hover:text-blue-700">Contact</a>
    </div>

    <!-- Hamburger button -->
    <div class="md:hidden">
      <button id="menu-toggle" class="text-gray-700 focus:outline-none">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2"
             viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round"
                d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile nav links -->
  <div id="mobile-menu" class="md:hidden hidden px-4 pb-4 space-y-2 text-sm">
    <a href="../../index.html#home" class="block text-gray-700 hover:text-blue-700">Home</a>
    <a href="../../index.html#algorithms" class="block text-gray-700 hover:text-blue-700">Algorithms</a>
    <a href="../../index.html#arduino" class="block text-gray-700 hover:text-blue-700">Arduino</a>
    <a href="../../index.html#about" class="block text-gray-700 hover:text-blue-700">About</a>
    <a href="../../index.html#contact" class="block text-gray-700 hover:text-blue-700">Contact</a>
  </div>
</nav>

<!-- ############################################################################################################################ -->
  <!-- Blog content -->
  <section class="max-w-3xl mx-auto mt-12 px-6">
    <h2 class="text-3xl font-bold text-blue-700 mb-6">Mo Algorithm</h2>

    <!-- Table of Contents -->
    <div class="border border-gray-300 rounded-lg bg-white shadow-sm p-4 mb-8">
      <h2 class="text-xl font-semibold flex items-center text-gray-700 mb-3">
        ðŸ“Œ <span class="ml-2">Table of Contents</span>
      </h2>
      <ul class="list-decimal list-inside space-y-1.5 text-blue-600 font-medium">
        <li><a href="#intro" class="hover:underline">Introduction</a></li>
        <li><a href="#sample" class="hover:underline">Sample Exercise</a></li>
      </ul>
    </div>  

    <!-- Section 1 -->
    <section id="intro" class="mb-10">
      <h2 class="text-2xl font-semibold text-blue-700 mb-3">1. Introduction</h2>
      <p class="mb-3">
        For problems with queries of the form <code>(L,R)</code> that can be transformed between queries to find the answer, we can use the Mo Algorithm by sorting the queries as follows: </p>
      <p class="mb-3">
        <div class="relative bg-gray-800 text-white rounded-lg overflow-hidden my-4">
        <button class="absolute top-2 right-2 text-xs px-2 py-1 bg-gray-700 hover:bg-gray-600 text-white rounded copy-btn">
          Copy
        </button>
        <pre class="language-cpp"><code class="language-cpp">
// Time complexity: (N+Q)*sqrt(N)*k 
// (k is time complexity of the add & del functions)
// value of "id" is from 1-n

struct query
{
    int l, r, id;
};
query q[maxn];

int s = sqrt(n);
bool cmp(query a,query b)
{
    if((a.l+s-1)/s!=(b.l+s-1)/s){
        return (a.l+s-1)/s&lt;(b.l+s-1)/s;
    }
    return a.r&lt;b.r;
}
        </code></pre>
      </div>
        <strong>When to use: </strong></p>
        <ul class="list-disc list-inside space-y-2 mb-2">
        <li>
            Calculate the sum/value of a specific segment of an array.        </li>
        <li>
            Count the number of distinct numbers in a segment.        </li>
        <li>
            Similar problems require processing offline queries.        </li>
      </ul>
    </section>

    <!-- Section 2 -->   
    <section id="sample" class="mb-10">
      <h2 class="text-2xl font-semibold text-blue-700 mb-3">2. Sample Exercise</h2>

      <ul class="list-disc list-inside space-y-2 mb-2">
        <li><a href="https://codeforces.com/group/w6L8aCVJN3/contest/525944/problem/C" class="text-blue-600 hover:underline">Problem: Value - Codeforces</a></li></ul>
      <div class="relative bg-gray-800 text-white rounded-lg overflow-hidden my-4">
        <button class="absolute top-2 right-2 text-xs px-2 py-1 bg-gray-700 hover:bg-gray-600 text-white rounded copy-btn">
          Copy
        </button>
        <pre class="language-cpp"><code class="language-cpp">
// Solution by Tien Minh
#include &lt;bits/stdc++.h&gt;
#define ff first
#define ss second
#define pp push_back
#define all(x) (x).begin(),(x).end()
using namespace std;
using ll = long long;
const char el ='\n';
const ll maxn = 1e6+5, mod = 1e9+7;
ll n,t,s,a[maxn],mark[maxn];
ll ans[maxn],num;

struct query
{
    int l, r, id;
};
query q[maxn];

bool cmp(query a,query b)
{
    if((a.l+s-1)/s!=(b.l+s-1)/s){
        return (a.l+s-1)/s&lt;(b.l+s-1)/s;
    }
    return a.r&lt;b.r;
}

void add(ll x)
{
    num=num-mark[x]*mark[x]*x;
    ++mark[x];
    num=num+mark[x]*mark[x]*x;
}

void del(ll x)
{
    num=num-mark[x]*mark[x]*x;
    --mark[x];
    num=num+mark[x]*mark[x]*x;
}

void input()
{
    cin&gt;&gt;n&gt;&gt;t;
    s=sqrt(n);
    for(int i=1;i&lt;=n;++i)   cin&gt;&gt;a[i];
    for(int i=1;i&lt;=t;++i)
    {
        cin&gt;&gt;q[i].l&gt;&gt;q[i].r;
        q[i].id=i;
    }
    sort(q+1,q+t+1,cmp);
    int l=1,r=0;
    for(int i=1;i&lt;=t;++i)
    {
        while(r&lt;q[i].r)
        {
            ++r;
            add(a[r]);
        }
        while(r&gt;q[i].r)
        {
            del(a[r]);
            --r;
        }
        while(l&gt;q[i].l)
        {
            --l;
            add(a[l]);
        }
        while(l&lt;q[i].l)
        {
            del(a[l]);
            ++l;
        }
        ans[q[i].id]=num;
    }
    for(int i=1;i&lt;=t;++i)   cout&lt;&lt;ans[i]&lt;&lt;el;
}

int main()
{
    ios_base::sync_with_stdio(false);
    cin.tie(nullptr);
    input();
    return 0;
}
        </code></pre>
      </div>
    </section>

  </section>
  <!-- ############################################################################################################################ -->
  <!-- Footer -->
  <footer class="mt-20 bg-white text-center py-6 text-gray-600 text-sm">
    Â© 2025 Phan Tien Minh. All rights reserved.
  </footer>

<!-- Responsive navbar   -->
<script>
  const toggleBtn = document.getElementById("menu-toggle");
  const mobileMenu = document.getElementById("mobile-menu");

  toggleBtn.addEventListener("click", () => {
    mobileMenu.classList.toggle("hidden");
  });
</script>
<script src="../../prism/prism.js"></script>
<script>
  document.querySelectorAll('.copy-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const code = btn.nextElementSibling.querySelector('code').innerText;

      navigator.clipboard.writeText(code).then(() => {
        btn.textContent = 'Copied!';
        setTimeout(() => {
          btn.textContent = 'Copy';
        }, 1500);
      }).catch(err => {
        console.error('Failed to copy: ', err);
      });
    });
  });
</script>
</body>
</html>